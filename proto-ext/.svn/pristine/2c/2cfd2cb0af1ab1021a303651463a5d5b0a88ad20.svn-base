;; http://localhost/tmp/webproto/?radius=25&numDevices=100&stepSize=1&program=(def%20flock%20(dir)%20%0A%20%20%20%20%20(rep%20v%20%20%0A%20%20%20%20%20%20%20%20%20%20(tup%200%200%200)%20%0A%20%20%20%20%20%20%20%20%20%20(let%20((d%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(normalize%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(int-hood%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(if%20(%3C%20(nbr-range)%205)%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(*%20-1%20(normalize%20(nbr-vec)))%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(if%20(%3E%20(nbr-range)%2010)%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(*%200.2%20(normalize%20(nbr-vec)))%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(normalize%20(nbr%20v))))))))%20%0A%20%20%20%20%20%20%20%20%20%20%20%20(normalize%20%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20(%2B%20dir%20(mux%20(%3E%20(vdot%20d%20d)%200)%20d%20v))))))%20%0A%20%0A(let%20((phase%20(*%20(timer)%200.1)))%20%0A%20%20(mov%20(flock%20(tup%20(sin%20phase)%20(cos%20phase)%200))))%20%0A

(def flock (dir)
     (rep v 
          (tup 0 0 0)
          (let ((d
                  (normalize
                    (int-hood
                      (if (< (nbr-range) 5)
                        (* -1 (normalize (nbr-vec)))
                        (if (> (nbr-range) 10)
                          (* 0.2 (normalize (nbr-vec)))
                          (normalize (nbr v))))))))
            (normalize 
              (+ dir (mux (> (vdot d d) 0) d v))))))

(let ((phase (* (timer) 0.1)))
  (mov (flock (tup (sin phase) (cos phase) 0))))
